<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Webgen::SourceHandler::Main</title>

	<link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

	<script src="../../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../../lib/webgen/sourcehandler_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/webgen/sourcehandler.rb">lib/webgen/sourcehandler.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">Object</p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-i-create_nodes">#create_nodes</a></li>
					
					<li><a href="#method-i-create_nodes_from_paths">#create_nodes_from_paths</a></li>
					
					<li><a href="#method-i-default_meta_info">#default_meta_info</a></li>
					
					<li><a href="#method-i-find_all_source_paths">#find_all_source_paths</a></li>
					
					<li><a href="#method-i-meta_info_changed%3F">#meta_info_changed?</a></li>
					
					<li><a href="#method-i-paths_for_handler">#paths_for_handler</a></li>
					
					<li><a href="#method-i-render">#render</a></li>
					
					<li><a href="#method-i-update_tree">#update_tree</a></li>
					
					<li><a href="#method-i-write_tree">#write_tree</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
			<div id="includes-section" class="section">
				<h3 class="section-header">Included Modules</h3>
				<ul class="link-list">
				
				
					<li><span class="include">WebsiteAccess</span></li>
				
				
				
					<li><span class="include">Loggable</span></li>
				
				
				</ul>
			</div>
			
		</div>

		<div id="project-metadata">
			
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../../Webgen.html">Webgen</a></li>
				
					<li><a href="../../Webgen/Blackboard.html">Webgen::Blackboard</a></li>
				
					<li><a href="../../Webgen/CLI.html">Webgen::CLI</a></li>
				
					<li><a href="../../Webgen/CLI/ApplyCommand.html">Webgen::CLI::ApplyCommand</a></li>
				
					<li><a href="../../Webgen/CLI/Color.html">Webgen::CLI::Color</a></li>
				
					<li><a href="../../Webgen/CLI/CommandParser.html">Webgen::CLI::CommandParser</a></li>
				
					<li><a href="../../Webgen/CLI/CreateCommand.html">Webgen::CLI::CreateCommand</a></li>
				
					<li><a href="../../Webgen/CLI/RunCommand.html">Webgen::CLI::RunCommand</a></li>
				
					<li><a href="../../Webgen/CLI/Utils.html">Webgen::CLI::Utils</a></li>
				
					<li><a href="../../Webgen/CLI/WebguiCommand.html">Webgen::CLI::WebguiCommand</a></li>
				
					<li><a href="../../Webgen/Cache.html">Webgen::Cache</a></li>
				
					<li><a href="../../Webgen/CommandNotFoundError.html">Webgen::CommandNotFoundError</a></li>
				
					<li><a href="../../Webgen/Common.html">Webgen::Common</a></li>
				
					<li><a href="../../Webgen/Common/Sitemap.html">Webgen::Common::Sitemap</a></li>
				
					<li><a href="../../Webgen/Configuration.html">Webgen::Configuration</a></li>
				
					<li><a href="../../Webgen/Configuration/Helpers.html">Webgen::Configuration::Helpers</a></li>
				
					<li><a href="../../Webgen/Configuration/MethodChain.html">Webgen::Configuration::MethodChain</a></li>
				
					<li><a href="../../Webgen/ContentProcessor.html">Webgen::ContentProcessor</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/AccessHash.html">Webgen::ContentProcessor::AccessHash</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Blocks.html">Webgen::ContentProcessor::Blocks</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Builder.html">Webgen::ContentProcessor::Builder</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Erb.html">Webgen::ContentProcessor::Erb</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Erubis.html">Webgen::ContentProcessor::Erubis</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Fragments.html">Webgen::ContentProcessor::Fragments</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Haml.html">Webgen::ContentProcessor::Haml</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Head.html">Webgen::ContentProcessor::Head</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Kramdown.html">Webgen::ContentProcessor::Kramdown</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/KramdownHtmlConverter.html">Webgen::ContentProcessor::KramdownHtmlConverter</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Less.html">Webgen::ContentProcessor::Less</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Maruku.html">Webgen::ContentProcessor::Maruku</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/RDiscount.html">Webgen::ContentProcessor::RDiscount</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/RDoc.html">Webgen::ContentProcessor::RDoc</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/RedCloth.html">Webgen::ContentProcessor::RedCloth</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Sass.html">Webgen::ContentProcessor::Sass</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Scss.html">Webgen::ContentProcessor::Scss</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Tags.html">Webgen::ContentProcessor::Tags</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Tidy.html">Webgen::ContentProcessor::Tidy</a></li>
				
					<li><a href="../../Webgen/ContentProcessor/Xmllint.html">Webgen::ContentProcessor::Xmllint</a></li>
				
					<li><a href="../../Webgen/Context.html">Webgen::Context</a></li>
				
					<li><a href="../../Webgen/Error.html">Webgen::Error</a></li>
				
					<li><a href="../../Webgen/Language.html">Webgen::Language</a></li>
				
					<li><a href="../../Webgen/LanguageManager.html">Webgen::LanguageManager</a></li>
				
					<li><a href="../../Webgen/LoadError.html">Webgen::LoadError</a></li>
				
					<li><a href="../../Webgen/Loggable.html">Webgen::Loggable</a></li>
				
					<li><a href="../../Webgen/Logger.html">Webgen::Logger</a></li>
				
					<li><a href="../../Webgen/Node.html">Webgen::Node</a></li>
				
					<li><a href="../../Webgen/NodeCreationError.html">Webgen::NodeCreationError</a></li>
				
					<li><a href="../../Webgen/Output.html">Webgen::Output</a></li>
				
					<li><a href="../../Webgen/Output/FileSystem.html">Webgen::Output::FileSystem</a></li>
				
					<li><a href="../../Webgen/Page.html">Webgen::Page</a></li>
				
					<li><a href="../../Webgen/Page/Block.html">Webgen::Page::Block</a></li>
				
					<li><a href="../../Webgen/Page/FormatError.html">Webgen::Page::FormatError</a></li>
				
					<li><a href="../../Webgen/Path.html">Webgen::Path</a></li>
				
					<li><a href="../../Webgen/Path/SourceIO.html">Webgen::Path::SourceIO</a></li>
				
					<li><a href="../../Webgen/ProxyNode.html">Webgen::ProxyNode</a></li>
				
					<li><a href="../../Webgen/RenderError.html">Webgen::RenderError</a></li>
				
					<li><a href="../../Webgen/Source.html">Webgen::Source</a></li>
				
					<li><a href="../../Webgen/Source/FileSystem.html">Webgen::Source::FileSystem</a></li>
				
					<li><a href="../../Webgen/Source/FileSystem/Path.html">Webgen::Source::FileSystem::Path</a></li>
				
					<li><a href="../../Webgen/Source/Resource.html">Webgen::Source::Resource</a></li>
				
					<li><a href="../../Webgen/Source/Stacked.html">Webgen::Source::Stacked</a></li>
				
					<li><a href="../../Webgen/Source/TarArchive.html">Webgen::Source::TarArchive</a></li>
				
					<li><a href="../../Webgen/Source/TarArchive/Path.html">Webgen::Source::TarArchive::Path</a></li>
				
					<li><a href="../../Webgen/SourceHandler.html">Webgen::SourceHandler</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Base.html">Webgen::SourceHandler::Base</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Base/OutputPathHelpers.html">Webgen::SourceHandler::Base::OutputPathHelpers</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Copy.html">Webgen::SourceHandler::Copy</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Directory.html">Webgen::SourceHandler::Directory</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Feed.html">Webgen::SourceHandler::Feed</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Fragment.html">Webgen::SourceHandler::Fragment</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Main.html">Webgen::SourceHandler::Main</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Memory.html">Webgen::SourceHandler::Memory</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Metainfo.html">Webgen::SourceHandler::Metainfo</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Page.html">Webgen::SourceHandler::Page</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Sitemap.html">Webgen::SourceHandler::Sitemap</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Template.html">Webgen::SourceHandler::Template</a></li>
				
					<li><a href="../../Webgen/SourceHandler/Virtual.html">Webgen::SourceHandler::Virtual</a></li>
				
					<li><a href="../../Webgen/Tag.html">Webgen::Tag</a></li>
				
					<li><a href="../../Webgen/Tag/Base.html">Webgen::Tag::Base</a></li>
				
					<li><a href="../../Webgen/Tag/BreadcrumbTrail.html">Webgen::Tag::BreadcrumbTrail</a></li>
				
					<li><a href="../../Webgen/Tag/Coderay.html">Webgen::Tag::Coderay</a></li>
				
					<li><a href="../../Webgen/Tag/Date.html">Webgen::Tag::Date</a></li>
				
					<li><a href="../../Webgen/Tag/ExecuteCommand.html">Webgen::Tag::ExecuteCommand</a></li>
				
					<li><a href="../../Webgen/Tag/IncludeFile.html">Webgen::Tag::IncludeFile</a></li>
				
					<li><a href="../../Webgen/Tag/Langbar.html">Webgen::Tag::Langbar</a></li>
				
					<li><a href="../../Webgen/Tag/Link.html">Webgen::Tag::Link</a></li>
				
					<li><a href="../../Webgen/Tag/Menu.html">Webgen::Tag::Menu</a></li>
				
					<li><a href="../../Webgen/Tag/Menu/MenuNode.html">Webgen::Tag::Menu::MenuNode</a></li>
				
					<li><a href="../../Webgen/Tag/Metainfo.html">Webgen::Tag::Metainfo</a></li>
				
					<li><a href="../../Webgen/Tag/Relocatable.html">Webgen::Tag::Relocatable</a></li>
				
					<li><a href="../../Webgen/Tag/Sitemap.html">Webgen::Tag::Sitemap</a></li>
				
					<li><a href="../../Webgen/Tree.html">Webgen::Tree</a></li>
				
					<li><a href="../../Webgen/WebgenTask.html">Webgen::WebgenTask</a></li>
				
					<li><a href="../../Webgen/Website.html">Webgen::Website</a></li>
				
					<li><a href="../../Webgen/Website/ConfigFileInvalid.html">Webgen::Website::ConfigFileInvalid</a></li>
				
					<li><a href="../../Webgen/WebsiteAccess.html">Webgen::WebsiteAccess</a></li>
				
					<li><a href="../../Webgen/WebsiteAccess/ClassMethods.html">Webgen::WebsiteAccess::ClassMethods</a></li>
				
					<li><a href="../../Webgen/WebsiteManager.html">Webgen::WebsiteManager</a></li>
				
					<li><a href="../../REXML.html">REXML</a></li>
				
					<li><a href="../../REXML/Parsers.html">REXML::Parsers</a></li>
				
					<li><a href="../../REXML/Parsers/BaseParser.html">REXML::Parsers::BaseParser</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Webgen::SourceHandler::Main</h1>

		<div id="description">
			<p>
This class is used by <a href="../Website.html">Website</a> to do the
actual rendering of the website. It
</p>
<ul>
<li><p>
collects all source paths using the source classes
</p>
</li>
<li><p>
creates nodes using the source handler classes
</p>
</li>
<li><p>
writes changed nodes out using an output class
</p>
</li>
<li><p>
deletes old nodes
</p>
</li>
</ul>

		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="render-method" class="method-detail ">
				<a name="method-i-render"></a>

				<div class="method-heading">
				
					<span class="method-name">render</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Render the current website. Before the actual rendering is done, the
sources are checked for changes, i.e. nodes for deleted sources are
deleted, nodes for new and changed sources are updated.
</p>
					

					
					<div class="method-source-code"
						id="render-source">
<pre>
    <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 54</span>
54:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>
55:         <span class="ruby-keyword kw">begin</span>
56:           <span class="ruby-identifier">website</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">mark_new_cycle</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">logger</span>
57: 
58:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Updating tree...&quot;</span>
59:           <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> <span class="ruby-keyword kw">do</span>
60:             <span class="ruby-identifier">website</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">reset_volatile_cache</span>
61:             <span class="ruby-identifier">update_tree</span>
62:           <span class="ruby-keyword kw">end</span>
63:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;...done in &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-value str">'%2.4f'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">' seconds'</span>
64: 
65:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">root</span>
66:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">'No source files found - maybe not a webgen website?'</span>
67:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
68:           <span class="ruby-keyword kw">end</span>
69: 
70:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Writing changed nodes...&quot;</span>
71:           <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> <span class="ruby-keyword kw">do</span>
72:             <span class="ruby-identifier">write_tree</span>
73:           <span class="ruby-keyword kw">end</span>
74:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;...done in &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-value str">'%2.4f'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">' seconds'</span>
75:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">node_access</span>[<span class="ruby-value">:alcn</span>].<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">node</span><span class="ruby-operator">|</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flagged?</span>(<span class="ruby-value">:created</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flagged?</span>(<span class="ruby-value">:reinit</span>)}
76:         <span class="ruby-value">:success</span>
77:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
78:         <span class="ruby-identifier">raise</span>
79:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
80:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>)
81:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="private-instance-method-details" class="method-section section">
			<h3 class="section-header">Private Instance Methods</h3>

		
			<div id="create-nodes-method" class="method-detail ">
				<a name="method-i-create_nodes"></a>

				<div class="method-heading">
				
					<span class="method-name">create_nodes</span><span
						class="method-args">(path, source_handler)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Prepare everything to create from the <tt>path</tt> using the
<tt>source_handler</tt>. If a block is given, the actual creation of the
nodes is deferred to it. Otherwise the # method of the
<tt>source_handler</tt> is used. After the nodes are created, it is also
checked if they have all needed properties.
</p>
					

					
					<div class="method-source-code"
						id="create-nodes-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 233</span>
233:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_nodes</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">source_handler</span>) <span class="ruby-comment cmt">#:yields: path</span>
234:         <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>
235:         <span class="ruby-identifier">path</span>.<span class="ruby-identifier">meta_info</span> = <span class="ruby-identifier">default_meta_info</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">source_handler</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>)
236:         (<span class="ruby-identifier">website</span>.<span class="ruby-identifier">cache</span>[<span class="ruby-value">:sourcehandler_path_mi</span>] <span class="ruby-operator">||=</span> {})[[<span class="ruby-identifier">path</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">source_handler</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>]] = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">meta_info</span>.<span class="ruby-identifier">dup</span>
237:         <span class="ruby-identifier">website</span>.<span class="ruby-identifier">blackboard</span>.<span class="ruby-identifier">dispatch_msg</span>(<span class="ruby-value">:before_node_created</span>, <span class="ruby-identifier">path</span>)
238:         *<span class="ruby-identifier">nodes</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
239:                    <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">path</span>)
240:                  <span class="ruby-keyword kw">else</span>
241:                    <span class="ruby-identifier">source_handler</span>.<span class="ruby-identifier">create_node</span>(<span class="ruby-identifier">path</span>)
242:                  <span class="ruby-keyword kw">end</span>
243:         <span class="ruby-identifier">nodes</span> = <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
244:         <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">blackboard</span>.<span class="ruby-identifier">dispatch_msg</span>(<span class="ruby-value">:after_node_created</span>, <span class="ruby-identifier">node</span>)}
245:         <span class="ruby-identifier">nodes</span>
246:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
247:         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span> = <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span>
248:         <span class="ruby-identifier">raise</span>
249:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
250:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">NodeCreationError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>, <span class="ruby-identifier">source_handler</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">path</span>)
251:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="create-nodes-from-paths-method" class="method-detail ">
				<a name="method-i-create_nodes_from_paths"></a>

				<div class="method-heading">
				
					<span class="method-name">create_nodes_from_paths</span><span
						class="method-args">(paths)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Use the source handlers to create nodes for the <tt>paths</tt> in the
<tt>website.tree</tt> and return the nodes that have been created.
</p>
					

					
					<div class="method-source-code"
						id="create-nodes-from-paths-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 212</span>
212:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_nodes_from_paths</span>(<span class="ruby-identifier">paths</span>)
213:         <span class="ruby-identifier">nodes</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
214:         <span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.invoke'</span>].<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">priority</span>, <span class="ruby-identifier">shns</span><span class="ruby-operator">|</span>
215:           <span class="ruby-identifier">shns</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">shn</span><span class="ruby-operator">|</span>
216:             <span class="ruby-identifier">sh</span> = <span class="ruby-identifier">website</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">instance</span>(<span class="ruby-identifier">shn</span>)
217:             <span class="ruby-identifier">handler_paths</span> = <span class="ruby-identifier">paths_for_handler</span>(<span class="ruby-identifier">shn</span>, <span class="ruby-identifier">paths</span>)
218:             <span class="ruby-identifier">handler_paths</span>.<span class="ruby-identifier">sort</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span>}.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
219:               <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>[<span class="ruby-identifier">path</span>.<span class="ruby-identifier">parent_path</span>]
220:                 <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">create_nodes_from_paths</span>([<span class="ruby-identifier">path</span>.<span class="ruby-identifier">parent_path</span>]))
221:               <span class="ruby-keyword kw">end</span>
222:               <span class="ruby-identifier">nodes</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">create_nodes</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">sh</span>)
223:             <span class="ruby-keyword kw">end</span>
224:           <span class="ruby-keyword kw">end</span>
225:         <span class="ruby-keyword kw">end</span>
226:         <span class="ruby-identifier">nodes</span>
227:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="default-meta-info-method" class="method-detail ">
				<a name="method-i-default_meta_info"></a>

				<div class="method-heading">
				
					<span class="method-name">default_meta_info</span><span
						class="method-args">(path, sh_name)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Return the default meta info for the pair of <tt>path</tt> and
<tt>sh_name</tt>.
</p>
					

					
					<div class="method-source-code"
						id="default-meta-info-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 254</span>
254:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_meta_info</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">sh_name</span>)
255:         <span class="ruby-identifier">path</span>.<span class="ruby-identifier">meta_info</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.default_meta_info'</span>][<span class="ruby-value">:all</span>]).
256:           <span class="ruby-identifier">merge</span>(<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.default_meta_info'</span>][<span class="ruby-identifier">sh_name</span>] <span class="ruby-operator">||</span> {})
257:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="find-all-source-paths-method" class="method-detail ">
				<a name="method-i-find_all_source_paths"></a>

				<div class="method-heading">
				
					<span class="method-name">find_all_source_paths</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Return a hash with all source paths.
</p>
					

					
					<div class="method-source-code"
						id="find-all-source-paths-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 176</span>
176:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_all_source_paths</span>
177:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@paths</span>)
178:           <span class="ruby-identifier">active_source</span> = <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">Stacked</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sources'</span>].<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mp</span>, <span class="ruby-identifier">name</span>, *<span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
179:                                                         [<span class="ruby-identifier">mp</span>, <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Common</span>.<span class="ruby-identifier">const_for_name</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">new</span>(*<span class="ruby-identifier">args</span>)]
180:                                                       <span class="ruby-keyword kw">end</span>)
181:           <span class="ruby-identifier">passive_source</span> = <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">Stacked</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'passive_sources'</span>].<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mp</span>, <span class="ruby-identifier">name</span>, *<span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
182:                                                          [<span class="ruby-identifier">mp</span>, <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Common</span>.<span class="ruby-identifier">const_for_name</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">new</span>(*<span class="ruby-identifier">args</span>)]
183:                                                        <span class="ruby-keyword kw">end</span>, <span class="ruby-keyword kw">true</span>)
184:           <span class="ruby-identifier">passive_source</span>.<span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">passive</span> = <span class="ruby-keyword kw">true</span> }
185:           <span class="ruby-identifier">source</span> = <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">Stacked</span>.<span class="ruby-identifier">new</span>([[<span class="ruby-value str">'/'</span>, <span class="ruby-identifier">active_source</span>], [<span class="ruby-value str">'/'</span>, <span class="ruby-identifier">passive_source</span>]])
186: 
187:           <span class="ruby-ivar">@paths</span> = {}
188:           <span class="ruby-identifier">source</span>.<span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
189:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.ignore'</span>].<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">pat</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">pat</span>, <span class="ruby-identifier">path</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span>)})
190:               <span class="ruby-ivar">@paths</span>[<span class="ruby-identifier">path</span>.<span class="ruby-identifier">source_path</span>] = <span class="ruby-identifier">path</span>
191:             <span class="ruby-keyword kw">end</span>
192:           <span class="ruby-keyword kw">end</span>
193:         <span class="ruby-keyword kw">end</span>
194:         <span class="ruby-ivar">@paths</span>
195:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="meta-info-changed--method" class="method-detail ">
				<a name="method-i-meta_info_changed%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">meta_info_changed?</span><span
						class="method-args">(node)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Check if the default meta information for <tt>node</tt> has changed since
the last run. But don&#8217;t take the node&#8217;s path&#8217;s
<tt>modified_at</tt> meta information into account since that changes on
every path change.
</p>
					

					
					<div class="method-source-code"
						id="meta-info-changed--source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 262</span>
262:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">meta_info_changed?</span>(<span class="ruby-identifier">node</span>)
263:         <span class="ruby-identifier">path</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:creation_path</span>]
264:         <span class="ruby-identifier">old_mi</span> = <span class="ruby-identifier">website</span>.<span class="ruby-identifier">cache</span>[<span class="ruby-value">:sourcehandler_path_mi</span>][[<span class="ruby-identifier">path</span>, <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:processor</span>]]]
265:         <span class="ruby-identifier">old_mi</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'modified_at'</span>)
266:         <span class="ruby-identifier">new_mi</span> = <span class="ruby-identifier">default_meta_info</span>(<span class="ruby-ivar">@paths</span>[<span class="ruby-identifier">path</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Path</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:processor</span>])
267:         <span class="ruby-identifier">new_mi</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'modified_at'</span>)
268:         <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flag</span>(<span class="ruby-value">:dirty_meta_info</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_mi</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">old_mi</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">new_mi</span>
269:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="paths-for-handler-method" class="method-detail ">
				<a name="method-i-paths_for_handler"></a>

				<div class="method-heading">
				
					<span class="method-name">paths_for_handler</span><span
						class="method-args">(name, paths)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Return only the subset of <tt>paths</tt> which are handled by the source
handler <tt>name</tt>.
</p>
					

					
					<div class="method-source-code"
						id="paths-for-handler-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 198</span>
198:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">paths_for_handler</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">paths</span>)
199:         <span class="ruby-identifier">patterns</span> = <span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.patterns'</span>][<span class="ruby-identifier">name</span>]
200:         <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">nil?</span>
201: 
202:         <span class="ruby-identifier">options</span> = (<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.casefold'</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) <span class="ruby-operator">|</span>
203:           (<span class="ruby-identifier">website</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value str">'sourcehandler.use_hidden_files'</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) <span class="ruby-operator">|</span>
204:           <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_PATHNAME</span>
205:         <span class="ruby-identifier">find_all_source_paths</span>.<span class="ruby-identifier">values_at</span>(*<span class="ruby-identifier">paths</span>).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
206:           <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">pat</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">pat</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>)}
207:         <span class="ruby-keyword kw">end</span>
208:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-tree-method" class="method-detail ">
				<a name="method-i-update_tree"></a>

				<div class="method-heading">
				
					<span class="method-name">update_tree</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Update the <tt>website.tree</tt> by creating/reinitializing all needed
nodes.
</p>
					

					
					<div class="method-source-code"
						id="update-tree-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 88</span>
 88:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_tree</span>
 89:         <span class="ruby-identifier">unused_paths</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
 90:         <span class="ruby-identifier">referenced_nodes</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
 91:         <span class="ruby-identifier">all_but_passive_paths</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">find_all_source_paths</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">path</span>.<span class="ruby-identifier">passive?</span>}.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>})
 92:         <span class="ruby-keyword kw">begin</span>
 93:           <span class="ruby-identifier">used_paths</span> = <span class="ruby-identifier">all_but_passive_paths</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">unused_paths</span>
 94:           <span class="ruby-identifier">paths_to_use</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
 95:           <span class="ruby-identifier">nodes_to_delete</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
 96:           <span class="ruby-identifier">passive_nodes</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
 97: 
 98:           <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">node_access</span>[<span class="ruby-value">:alcn</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">alcn</span>, <span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
 99:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">dummy_root</span>
100: 
101:             <span class="ruby-keyword kw">begin</span>
102:               <span class="ruby-identifier">used_paths</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:src</span>])
103: 
104:               <span class="ruby-identifier">src_path</span> = <span class="ruby-identifier">find_all_source_paths</span>[<span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:src</span>]]
105:               <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">src_path</span>
106:                 <span class="ruby-identifier">nodes_to_delete</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span>
107:               <span class="ruby-keyword kw">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">node</span>.<span class="ruby-identifier">flagged?</span>(<span class="ruby-value">:created</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src_path</span>.<span class="ruby-identifier">changed?</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">meta_info_changed?</span>
108:                 <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flag</span>(<span class="ruby-value">:reinit</span>)
109:                 <span class="ruby-identifier">paths_to_use</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:src</span>]
110:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">changed?</span>
111:                 <span class="ruby-comment cmt"># nothing to be done here but method node.changed? has to be called</span>
112:               <span class="ruby-keyword kw">end</span>
113: 
114:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src_path</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src_path</span>.<span class="ruby-identifier">passive?</span>
115:                 <span class="ruby-identifier">passive_nodes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span>
116:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src_path</span>
117:                 <span class="ruby-identifier">referenced_nodes</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:used_meta_info_nodes</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:used_nodes</span>]
118:               <span class="ruby-keyword kw">end</span>
119:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
120:               <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">alcn</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span>
121:               <span class="ruby-identifier">raise</span>
122:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
123:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">node</span>)
124:             <span class="ruby-keyword kw">end</span>
125:           <span class="ruby-keyword kw">end</span>
126: 
127:           <span class="ruby-comment cmt"># add unused passive nodes to node_to_delete set</span>
128:           <span class="ruby-identifier">unreferenced_passive_nodes</span>, <span class="ruby-identifier">other_passive_nodes</span> = <span class="ruby-identifier">passive_nodes</span>.<span class="ruby-identifier">partition</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pnode</span><span class="ruby-operator">|</span>
129:             <span class="ruby-operator">!</span><span class="ruby-identifier">referenced_nodes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">pnode</span>.<span class="ruby-identifier">alcn</span>)
130:           <span class="ruby-keyword kw">end</span>
131:           <span class="ruby-identifier">refs</span> = <span class="ruby-identifier">other_passive_nodes</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">n</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:used_meta_info_nodes</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:used_nodes</span>]).<span class="ruby-identifier">to_a</span>}.<span class="ruby-identifier">flatten</span>
132:           <span class="ruby-identifier">unreferenced_passive_nodes</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">nodes_to_delete</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">n</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">refs</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">n</span>.<span class="ruby-identifier">alcn</span>)}
133: 
134:           <span class="ruby-identifier">nodes_to_delete</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">delete_node</span>(<span class="ruby-identifier">node</span>)}
135:           <span class="ruby-identifier">used_paths</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">paths_to_use</span>)
136:           <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">create_nodes_from_paths</span>(<span class="ruby-identifier">used_paths</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">node_info</span>[<span class="ruby-value">:src</span>]}
137:           <span class="ruby-identifier">unused_paths</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">used_paths</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">paths</span>)
138:           <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">node_access</span>[<span class="ruby-value">:alcn</span>].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">node</span><span class="ruby-operator">|</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">delete_node</span>(<span class="ruby-identifier">node</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flagged?</span>(<span class="ruby-value">:reinit</span>)}
139:           <span class="ruby-identifier">website</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">reset_volatile_cache</span>
140:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">used_paths</span>.<span class="ruby-identifier">empty?</span>
141:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="write-tree-method" class="method-detail ">
				<a name="method-i-write_tree"></a>

				<div class="method-heading">
				
					<span class="method-name">write_tree</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Write out all changed nodes of the <tt>website.tree</tt>.
</p>
					

					
					<div class="method-source-code"
						id="write-tree-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/sourcehandler.rb, line 144</span>
144:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_tree</span>
145:         <span class="ruby-identifier">output</span> = <span class="ruby-identifier">website</span>.<span class="ruby-identifier">blackboard</span>.<span class="ruby-identifier">invoke</span>(<span class="ruby-value">:output_instance</span>)
146: 
147:         <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">node_access</span>[<span class="ruby-value">:alcn</span>].<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
148:           <span class="ruby-identifier">use_node</span> = (<span class="ruby-identifier">node</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">website</span>.<span class="ruby-identifier">tree</span>.<span class="ruby-identifier">dummy_root</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">flagged?</span>(<span class="ruby-value">:dirty</span>))
149:           <span class="ruby-identifier">node</span>.<span class="ruby-identifier">unflag</span>(<span class="ruby-value">:dirty_meta_info</span>)
150:           <span class="ruby-identifier">node</span>.<span class="ruby-identifier">unflag</span>(<span class="ruby-value">:created</span>)
151:           <span class="ruby-identifier">node</span>.<span class="ruby-identifier">unflag</span>(<span class="ruby-value">:dirty</span>)
152:           <span class="ruby-identifier">use_node</span>
153:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
154:           <span class="ruby-keyword kw">begin</span>
155:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node</span>[<span class="ruby-value str">'no_output'</span>] <span class="ruby-operator">||</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">content</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">content</span>)
156: 
157:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot; &quot;</span>*<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:verbose</span>
158:             <span class="ruby-identifier">type</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">is_directory?</span>
159:                      <span class="ruby-value">:directory</span>
160:                    <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">is_fragment?</span>
161:                      <span class="ruby-value">:fragment</span>
162:                    <span class="ruby-keyword kw">else</span>
163:                      <span class="ruby-value">:file</span>
164:                    <span class="ruby-keyword kw">end</span>
165:             <span class="ruby-identifier">output</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">node</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">type</span>)
166:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
167:             <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">alcn</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">alcn</span>
168:             <span class="ruby-identifier">raise</span>
169:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
170:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Webgen</span><span class="ruby-operator">::</span><span class="ruby-constant">RenderError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">e</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">node</span>)
171:           <span class="ruby-keyword kw">end</span>
172:         <span class="ruby-keyword kw">end</span>
173:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

