<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Webgen::PluginManager</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Webgen::PluginManager</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/webgen/plugin_rb.html">
                lib/webgen/plugin.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Once plugin classes are loaded, they are ready to get used. This class is
used for instantiating plugins and their dependencies in the correct order
and provide the plugins the facility for retrieving current parameter
values.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000235">[]</a>&nbsp;&nbsp;
      <a href="#M000233">add_plugin_classes</a>&nbsp;&nbsp;
      <a href="#M000234">init</a>&nbsp;&nbsp;
      <a href="#M000239">log_msg</a>&nbsp;&nbsp;
      <a href="#M000231">new</a>&nbsp;&nbsp;
      <a href="#M000238">optional_part</a>&nbsp;&nbsp;
      <a href="#M000236">param_for_plugin</a>&nbsp;&nbsp;
      <a href="#M000237">plugin_class_for_name</a>&nbsp;&nbsp;
      <a href="#M000232">plugin_classes</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">logger</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
The logger used by the instance and the plugin objects.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">plugin_config</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Used for retrieving current plugin parameter values. Should be set before
calling <a href="PluginManager.html#M000234">init</a>.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">plugin_loaders</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Used for plugin dependency resolution.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">plugins</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A hash of all instantiated plugins.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000231" class="method-detail">
        <a name="M000231"></a>

        <div class="method-heading">
          <a href="#M000231" class="method-signature">
          <span class="method-name">new</span><span class="method-args">( plugin_loaders = [], plugin_classes = [] )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="PluginManager.html#M000231">new</a> <a
href="PluginManager.html">PluginManager</a> instance.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000231-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000231-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 340</span>
340:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">plugin_loaders</span> = [], <span class="ruby-identifier">plugin_classes</span> = [] )
341:       <span class="ruby-ivar">@logger</span> = <span class="ruby-keyword kw">nil</span>
342:       <span class="ruby-ivar">@plugins</span> = {}
343:       <span class="ruby-ivar">@plugin_classes</span> = {}
344:       <span class="ruby-ivar">@plugin_loaders</span> = <span class="ruby-identifier">plugin_loaders</span>
345:       <span class="ruby-ivar">@plugin_config</span> = <span class="ruby-keyword kw">nil</span>
346:       <span class="ruby-identifier">add_plugin_classes</span>( <span class="ruby-identifier">plugin_classes</span> )
347:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000235" class="method-detail">
        <a name="M000235"></a>

        <div class="method-heading">
          <a href="#M000235" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">( plugin_name )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the plugin instance for the plugin called <tt>plugin_name</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000235-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000235-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 377</span>
377:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>( <span class="ruby-identifier">plugin_name</span> )
378:       <span class="ruby-ivar">@plugins</span>[<span class="ruby-identifier">plugin_name</span>]
379:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000233" class="method-detail">
        <a name="M000233"></a>

        <div class="method-heading">
          <a href="#M000233" class="method-signature">
          <span class="method-name">add_plugin_classes</span><span class="method-args">( plugins )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds all Plugin classes in the array <tt>plugins</tt> and their
dependencies.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000233-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000233-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 355</span>
355:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_plugin_classes</span>( <span class="ruby-identifier">plugins</span> )
356:       <span class="ruby-identifier">deps</span> = <span class="ruby-identifier">dependent_plugins</span>( <span class="ruby-identifier">plugins</span> )
357:       (<span class="ruby-identifier">plugins</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">deps</span>).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@plugin_classes</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">plugin_name</span>] = <span class="ruby-identifier">p</span> }
358:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000234" class="method-detail">
        <a name="M000234"></a>

        <div class="method-heading">
          <a href="#M000234" class="method-signature">
          <span class="method-name">init</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instantiates the plugins in the correct order, except the classes which
have the plugin info +:instantiate+ set to <tt>false</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000234-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000234-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 362</span>
362:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init</span>
363:       <span class="ruby-ivar">@plugins</span> = {}
364:       <span class="ruby-comment cmt">#precalculate_param_values! #TODO: maybe activate this feature</span>
365:       <span class="ruby-identifier">dep</span> = <span class="ruby-constant">DependencyHash</span>.<span class="ruby-identifier">new</span>
366:       <span class="ruby-ivar">@plugin_classes</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dep</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">dependencies</span> }
367:       <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">tsort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin_name</span><span class="ruby-operator">|</span>
368:         <span class="ruby-identifier">config</span> = <span class="ruby-identifier">plugin_class_for_name</span>( <span class="ruby-identifier">plugin_name</span> ).<span class="ruby-identifier">config</span>
369:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">infos</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:instantiate</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">config</span>.<span class="ruby-identifier">infos</span>[<span class="ruby-identifier">:instantiate</span>]
370:           <span class="ruby-identifier">log_msg</span>( <span class="ruby-identifier">:debug</span>, <span class="ruby-value str">'PluginManager#init'</span>) { <span class="ruby-node">&quot;Creating instance of plugin #{plugin_name}&quot;</span> }
371:           <span class="ruby-ivar">@plugins</span>[<span class="ruby-identifier">plugin_name</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">plugin_klass</span>.<span class="ruby-identifier">new</span>( <span class="ruby-keyword kw">self</span> )
372:         <span class="ruby-keyword kw">end</span>
373:       <span class="ruby-keyword kw">end</span>
374:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000239" class="method-detail">
        <a name="M000239"></a>

        <div class="method-heading">
          <a href="#M000239" class="method-signature">
          <span class="method-name">log_msg</span><span class="method-args">( sev_level, source, &amp;block )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Logs the result of executing <tt>block</tt> under the severity level
<tt>sev_level</tt>. The parameter <tt>source</tt> identifies the source of
the log message.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000239-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000239-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 415</span>
415:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_msg</span>( <span class="ruby-identifier">sev_level</span>, <span class="ruby-identifier">source</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
416:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">send</span>( <span class="ruby-identifier">sev_level</span>, <span class="ruby-identifier">source</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@logger</span>
417:       <span class="ruby-keyword kw">nil</span>
418:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000238" class="method-detail">
        <a name="M000238"></a>

        <div class="method-heading">
          <a href="#M000238" class="method-signature">
          <span class="method-name">optional_part</span><span class="method-args">( name )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the options hash for the given optional library.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000238-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000238-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 409</span>
409:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">optional_part</span>( <span class="ruby-identifier">name</span> )
410:       <span class="ruby-ivar">@plugin_loaders</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pl</span>.<span class="ruby-identifier">optional_parts</span>[<span class="ruby-identifier">name</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pl</span>.<span class="ruby-identifier">optional_parts</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-identifier">name</span> ) }
411:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000236" class="method-detail">
        <a name="M000236"></a>

        <div class="method-heading">
          <a href="#M000236" class="method-signature">
          <span class="method-name">param_for_plugin</span><span class="method-args">( plugin_name, param )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the parameter <tt>param</tt> for the plugin called
<tt>plugin_name</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000236-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000236-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 382</span>
382:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">param_for_plugin</span>( <span class="ruby-identifier">plugin_name</span>, <span class="ruby-identifier">param</span> )
383:       <span class="ruby-identifier">plugin</span> = <span class="ruby-identifier">plugin_class_for_name</span>( <span class="ruby-identifier">plugin_name</span> )
384:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">PluginParamNotFound</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">plugin_name</span>, <span class="ruby-identifier">param</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">nil?</span>
385: 
386:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@precalculated_param_values</span>
387:         <span class="ruby-identifier">value</span> = <span class="ruby-ivar">@precalculated_param_values</span>[<span class="ruby-identifier">plugin_name</span>][<span class="ruby-identifier">param</span>]
388:       <span class="ruby-keyword kw">else</span>
389:         <span class="ruby-identifier">value</span> = <span class="ruby-constant">PluginParamValueNotFound</span>
390:         <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">ancestor_classes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin_klass</span><span class="ruby-operator">|</span>
391:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">get_plugin_param_value</span>( <span class="ruby-identifier">plugin_klass</span>.<span class="ruby-identifier">plugin_name</span>, <span class="ruby-identifier">plugin_klass</span>.<span class="ruby-identifier">config</span>, <span class="ruby-identifier">param</span> )
392:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-constant">PluginParamValueNotFound</span>
393:         <span class="ruby-keyword kw">end</span>
394:       <span class="ruby-keyword kw">end</span>
395: 
396:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">PluginParamValueNotFound</span>
397:         <span class="ruby-identifier">value</span>
398:       <span class="ruby-keyword kw">else</span>
399:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">PluginParamNotFound</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">plugin_name</span>, <span class="ruby-identifier">param</span> )
400:       <span class="ruby-keyword kw">end</span>
401:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000237" class="method-detail">
        <a name="M000237"></a>

        <div class="method-heading">
          <a href="#M000237" class="method-signature">
          <span class="method-name">plugin_class_for_name</span><span class="method-args">( plugin_name )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the plugin class for the plugin <tt>plugin_name</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000237-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000237-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 404</span>
404:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">plugin_class_for_name</span>( <span class="ruby-identifier">plugin_name</span> )
405:       <span class="ruby-ivar">@plugin_classes</span>[<span class="ruby-identifier">plugin_name</span>]
406:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000232" class="method-detail">
        <a name="M000232"></a>

        <div class="method-heading">
          <a href="#M000232" class="method-signature">
          <span class="method-name">plugin_classes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A list of all plugins that should get instantiated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000232-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000232-source">
<pre>
     <span class="ruby-comment cmt"># File lib/webgen/plugin.rb, line 350</span>
350:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">plugin_classes</span>
351:       <span class="ruby-ivar">@plugin_classes</span>.<span class="ruby-identifier">values</span>
352:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>